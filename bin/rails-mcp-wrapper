#!/usr/bin/env bash
set -euo pipefail

if [ -z "${MCP_RAILS_APP_DIR:-}" ]; then
    echo "Error: MCP_RAILS_APP_DIR must be set" >&2; exit 1
fi

USER_SHELL="${SHELL:-/bin/bash}"
exec 3>&1 1>&2

exec "$USER_SHELL" -l -c '
    exec 1>&3 3>&-
    cd "$1" || exit 1
    exec bundle exec rails-active-mcp-server "$@"
' _ "$MCP_RAILS_APP_DIR" "$@"
